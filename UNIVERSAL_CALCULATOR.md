# Универсальный калькулятор для ServiceCategory

## Обзор

В ServiceCategory блоки добавлен полностью настраиваемый универсальный калькулятор, который можно редактировать в MoonShine админ-панели и отображать на страницах категорий услуг.

## Возможности

- ✅ Полностью настраиваемые поля ввода (number, text, select, radio, checkbox, range)
- ✅ Настраиваемые заголовки и описания
- ✅ Пользовательские формулы расчета
- ✅ Настраиваемая валюта
- ✅ Поля с опциями (для select и radio)
- ✅ Минимальные и максимальные значения
- ✅ Шаги для числовых полей
- ✅ Значения по умолчанию
- ✅ Поддержка всех типов полей формы
- ✅ JavaScript для расчета в реальном времени

## Настройка в MoonShine

### 1. Перейдите в админ-панель MoonShine

### 2. Откройте ServiceCategory Resource

### 3. Создайте или отредактируйте ServiceCategory

### 4. Перейдите на вкладку "Калькулятор"

### 5. Настройте следующие поля:

#### Основные настройки:
- **Включить калькулятор**: Включает/отключает отображение калькулятора на сайте
- **Заголовок калькулятора**: Заголовок секции калькулятора
- **Описание калькулятора**: Текст с описанием калькулятора (поддерживает HTML)
- **Подпись результата**: Текст над результатом расчета (по умолчанию "Итоговая стоимость")
- **Валюта**: Символ валюты (например: BYN, руб., $, €)

#### Формула расчета:
- **Формула**: Математическая формула расчета
- Используйте `{field_key}` для подстановки значений полей
- Примеры:
  - `{width} * {height} * {price}`
  - `{area} * {rate} + {additional}`
  - `{base_price} * {quantity} * {complexity}`

#### Поля калькулятора:
Настройте каждый поле калькулятора:

**Основные параметры:**
- **Ключ**: Уникальный идентификатор поля (только латиница, без пробелов)
- **Название**: Отображаемое название поля
- **Тип**: Тип поля ввода
  - `number` - числовое поле
  - `text` - текстовое поле
  - `select` - выпадающий список
  - `radio` - переключатели
  - `checkbox` - чекбокс
  - `range` - ползунок

**Дополнительные параметры (зависит от типа поля):**
- **Значение по умолчанию**: Значение при загрузке страницы
- **Плейсхолдер**: Подсказка в поле ввода
- **Минимум**: Минимальное значение (для number/range)
- **Максимум**: Максимальное значение (для number/range)
- **Шаг**: Шаг изменения (для number/range)

**Варианты выбора (для select/radio):**
- **Название**: Отображаемый текст варианта
- **Значение**: Числовое значение варианта

## Примеры настройки

### Пример 1: Калькулятор площади комнаты

**Формула:** `{width} * {length} * {price}`

**Поля:**
1. **Ширина** (width)
   - Тип: number
   - Минимум: 1
   - Максимум: 20
   - Значение по умолчанию: 5

2. **Длина** (length)
   - Тип: number
   - Минимум: 1
   - Максимум: 20
   - Значение по умолчанию: 4

3. **Цена за м²** (price)
   - Тип: number
   - Минимум: 50
   - Максимум: 500
   - Значение по умолчанию: 150

### Пример 2: Калькулятор стоимости работ

**Формула:** `{base_price} * {area} * {complexity} + {delivery}`

**Поля:**
1. **Базовый тариф** (base_price)
   - Тип: number
   - Значение по умолчанию: 100

2. **Площадь** (area)
   - Тип: range
   - Минимум: 10
   - Максимум: 500
   - Шаг: 10
   - Значение по умолчанию: 100

3. **Сложность работ** (complexity)
   - Тип: select
   - Варианты:
     - Простая (1)
     - Средняя (1.5)
     - Сложная (2)

4. **Доставка** (delivery)
   - Тип: radio
   - Варианты:
     - Включена (0)
     - Не включена (50)

### Пример 3: Калькулятор с чекбоксами

**Формула:** `{base_price} + {premium} + {warranty}`

**Поля:**
1. **Базовый тариф** (base_price)
   - Тип: number
   - Значение по умолчанию: 1000

2. **Премиум обработка** (premium)
   - Тип: checkbox
   - Значение по умолчанию: 0
   - Дополнительные опции: "checkbox_label": "Премиум обработка (+200)"

3. **Расширенная гарантия** (warranty)
   - Тип: checkbox
   - Значение по умолчанию: 0
   - Дополнительные опции: "checkbox_label": "Расширенная гарантия (+150)"

## Функциональность

### На странице сайта:
- Калькулятор отображается только если включен в настройках
- Автоматически подтягивает настройки из базы данных
- Реагирует на изменения полей ввода в реальном времени
- Форматирует результат с разделением тысяч
- Кнопки "Пересчитать" и "Сбросить"

### Безопасность:
- Формула валидируется на клиенте
- Разрешены только математические операции
- Автоматический сброс при ошибках расчета

## Технические детали

### База данных:
- Все калькуляторные поля хранятся в таблице `service_categories`
- Поля калькулятора хранятся в JSON формате
- Формула хранится как текст

### Frontend:
- JavaScript код встроен в blade-шаблон
- Использует стандартные Bootstrap классы
- Адаптивный дизайн

### Backend:
- Модель ServiceCategory расширена новыми полями
- MoonShine Resource настроен для редактирования калькулятора
- Валидация на уровне формы

## Решение проблем

### Калькулятор не отображается:
1. Проверьте, что в настройках включен "Включить калькулятор"
2. Убедитесь, что добавлено хотя бы одно поле калькулятора
3. Проверьте, что категория активна

### Ошибка расчета:
1. Проверьте синтаксис формулы
2. Убедитесь, что все поля в формуле существуют (ключи совпадают)
3. Проверьте числовые значения полей

### Поля не работают:
1. Проверьте, что ключи полей уникальны и написаны латиницей
2. Убедитесь, что типы полей корректны
3. Для select/radio проверьте наличие вариантов выбора

## Планы развития

- [ ] Сохранение расчетов пользователей
- [ ] Экспорт результатов
- [ ] Интеграция с CRM
- [ ] Дополнительные типы полей
- [ ] Валидация на сервере
- [ ] История изменений настроек